<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Neon Snake - Pink Pro</title>
  

  <style>
    :root{
      --bg:#0a0810;
      --panel:#130f18;
      --ink:#ffeaf7;
      --ink-dim:#f2b8dd;
      --ac:#ff51b8;     /* pink main best guy */
      --ac2:#ff89d7;    /* pink first loser  */
      --danger:#ff6b6b;
      --grid:#2b1d2b;
      --chip:#1c1420;
    }
    [data-contrast="high"]{
      --bg:#000;
      --panel:#0f0f0f;
      --ink:#fff;
      --ink-dim:#cfcfcf;
      --ac:#ff3cae;
      --ac2:#ff86d6;
      --grid:#3a3a3a;
      --chip:#161616;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background: radial-gradient(900px 600px at 15% -10%, rgba(255,81,184,.18) 0%, rgba(255,81,184,0) 60%),
                  radial-gradient(700px 500px at 100% 0%, rgba(255,137,215,.12) 0%, rgba(255,137,215,0) 55%),
                  var(--bg);
      display:grid; place-items:center; padding:16px;
    }

    .app{display:grid; gap:16px; width:min(1100px,100%)}
    header{display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:12px}
    h1{font-size:clamp(20px,3vw,28px); margin:0; letter-spacing:.5px; color:var(--ac)}
    .meta{color:var(--ink-dim); font-size:14px}
    .grid{display:grid; grid-template-columns: 1fr 320px; gap:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0)); border:1px solid rgba(255,255,255,0.1); border-radius:16px; box-shadow:0 10px 30px rgba(255,81,184,.25)}
    .stage-wrap{position:relative; aspect-ratio:1/1}
    canvas{width:100%; height:100%; display:block; border-radius:16px}

    .hud{position:absolute; inset:auto 12px 12px 12px; display:flex; align-items:center; justify-content:space-between; gap:8px; pointer-events:none}
    .chip{pointer-events:auto; background:var(--chip); border:1px solid rgba(255,255,255,.12); color:var(--ink); padding:6px 10px; border-radius:999px; font-size:14px}

    .controls{padding:14px}
    .controls h2{margin:0 0 6px; font-size:16px; color:var(--ac)}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 0; border-bottom:1px dashed rgba(255,255,255,.08)}
    .row:last-child{border-bottom:none}
    .row label{font-size:14px; color:var(--ink-dim)}
    .row input[type="range"]{width:160px}

    .btns{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    button{background:var(--panel); color:var(--ink); border:1px solid rgba(255,255,255,.12); padding:8px 12px; border-radius:10px; cursor:pointer}
    button:focus-visible{outline:2px solid var(--ac)}
    .primary{background:linear-gradient(90deg, var(--ac2), var(--ac)); color:#250b1c; border:none; font-weight:600}

    .status{padding:12px; color:var(--ink-dim); font-size:14px}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; background:#120b16; border:1px solid rgba(255,255,255,.12); padding:2px 6px; border-radius:6px; color:var(--ac)}

    .touch{display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:10px}
    .touch button{padding:16px 0}

    .badge{position:absolute; top:10px; left:10px; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.15); padding:6px 10px; border-radius:999px; font-size:12px; color:var(--ink-dim)}

    .gameover{position:absolute; inset:0; display:none; place-items:center; background:rgba(0,0,0,.45); border-radius:16px}
    .gameover.show{display:grid}
    .card{background:var(--panel); padding:20px; border:1px solid rgba(255,255,255,.12); border-radius:12px; text-align:center; max-width:320px}
    .card h3{margin:0 0 6px; color:var(--ac)}
    .muted{color:var(--ink-dim)}
  </style>
</head>
<body>
  <div class="app" data-contrast="normal">
    <header>
      <h1>Neon Snake</h1>
      <div class="meta">WASD or arrows to move, <span class="kbd">Space</span> to pause</div>
    </header>

    <div class="grid">
      <section class="panel stage-wrap">
        <canvas id="game" width="600" height="600" aria-label="Snake game area" role="img"></canvas>
        <div class="badge" id="announce" aria-live="polite"></div>
        <div class="hud">
          <span class="chip">Score: <strong id="score">0</strong></span>
          <span class="chip">High: <strong id="high">0</strong></span>
          <button id="pause" class="chip">Pause</button>
        </div>
        <div id="overlay" class="gameover">
          <div class="card">
            <h3>Game Over</h3>
            <p class="muted">Score <span id="finalScore">0</span> • High <span id="finalHigh">0</span></p>
            <div class="btns"><button id="restart" class="primary">Restart</button></div>
          </div>
        </div>
      </section>

      <aside class="panel controls" aria-label="Settings">
        <h2>Settings</h2>
        <div class="row">
          <label for="speed">Speed</label>
          <input id="speed" type="range" min="4" max="14" step="1" value="8" />
        </div>
        <div class="row">
          <label for="wrap">Wrap walls</label>
          <input id="wrap" type="checkbox" checked />
        </div>
        <div class="row">
          <label for="grid">Show grid</label>
          <input id="grid" type="checkbox" checked />
        </div>
        <div class="row">
          <label for="contrast">High contrast</label>
          <input id="contrast" type="checkbox" />
        </div>
        <div class="row">
          <label for="motion">Reduced motion</label>
          <input id="motion" type="checkbox" />
        </div>
        <div class="btns">
          <button id="btnReset">Reset high score</button>
          <button id="btnNewSeed">New seed</button>
        </div>

        <div class="status">
          <div>Touch controls</div>
          <div class="touch" aria-hidden="false">
            <button id="up">Up</button>
            <button id="right">Right</button>
            <button id="down">Down</button>
            <button id="left" style="grid-column:1">Left</button>
          </div>
        </div>

        <div class="status">
          <div>Tech stack</div>
          <div class="muted">Vanilla HTML, CSS, JS • Canvas • LocalStorage • ARIA</div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Utility: PRNG with seed for reproducible food placement
    class RNG{constructor(seed=Date.now()){this.s=seed>>>0;} next(){let t=this.s+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296;}}

    // Canvas setup
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const dpr = Math.max(1, window.devicePixelRatio || 1);

    function scaleCanvas(){
      const r = canvas.getBoundingClientRect();
      canvas.width = Math.floor(r.width * dpr);
      canvas.height = Math.floor(r.height * dpr);
    }

    // Grid setup
    const CELL = 24; // CSS px per cell for layout math
    const GRID = Math.floor(canvas.width / CELL); // will be recalculated after scaling

    // State
    let state = {
      running:true,
      over:false,
      speed:8,               // steps per second
      wrap:true,
      showGrid:true,
      contrast:false,
      reducedMotion:false,
      score:0,
      high: parseInt(localStorage.getItem('neon.high')||'0'),
      dir:{x:1,y:0},
      nextDir:{x:1,y:0},
      snake:[{x:5,y:5}],
      food:{x:10,y:10},
      rng: new RNG(parseInt(localStorage.getItem('neon.seed')||String(Date.now()))),
    };

    // Persisted settings
    function saveSettings(){
      localStorage.setItem('neon.wrap', state.wrap? '1':'0');
      localStorage.setItem('neon.grid', state.showGrid? '1':'0');
      localStorage.setItem('neon.contrast', state.contrast? '1':'0');
      localStorage.setItem('neon.motion', state.reducedMotion? '1':'0');
      localStorage.setItem('neon.speed', String(state.speed));
    }
    function loadSettings(){
      state.wrap = localStorage.getItem('neon.wrap') !== '0';
      state.showGrid = localStorage.getItem('neon.grid') !== '0';
      state.contrast = localStorage.getItem('neon.contrast') === '1';
      state.reducedMotion = localStorage.getItem('neon.motion') === '1';
      const s = parseInt(localStorage.getItem('neon.speed')||'8');
      if(!Number.isNaN(s)) state.speed = s;
    }

    function announce(msg){
      document.getElementById('announce').textContent = msg;
    }

    // Grid helpers computed 4rm actual device pixels
    function metrics(){
      const cellW = canvas.width / Math.floor(canvas.clientWidth / CELL);
      const cellH = canvas.height / Math.floor(canvas.clientHeight / CELL);
      const cols = Math.floor(canvas.width / cellW);
      const rows = Math.floor(canvas.height / cellH);
      return {cellW, cellH, cols, rows};
    }

    function rndInt(n){ return Math.floor(state.rng.next()*n); }
    function placeFood(){
      const m = metrics();
      let pos, coll=true, tries=0;
      while(coll && tries<1024){
        pos = {x:rndInt(m.cols), y:rndInt(m.rows)}; tries++;
        coll = state.snake.some(s=> s.x===pos.x && s.y===pos.y);
      }
      state.food = pos; announce('Food placed');
    }

    function reset(){
      state.over=false; state.running=true; state.score=0;
      state.dir={x:1,y:0}; state.nextDir={x:1,y:0};
      state.snake=[{x:5,y:5}]; placeFood();
      document.getElementById('score').textContent = state.score;
      document.getElementById('overlay').classList.remove('show');
    }

    // Input maps
    const keyMap = { ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0}, w:{x:0,y:-1}, s:{x:0,y:1}, a:{x:-1,y:0}, d:{x:1,y:0} };
    window.addEventListener('keydown',(e)=>{
      if(e.code==='Space'){ togglePause(); e.preventDefault(); return; }
      const nd = keyMap[e.key]; if(!nd) return;
      if(-nd.x!==state.dir.x || -nd.y!==state.dir.y){ state.nextDir = nd; }
    });

    // Touchy buttons
    [['up','ArrowUp'],['down','ArrowDown'],['left','ArrowLeft'],['right','ArrowRight']].forEach(([id,key])=>{
      document.getElementById(id).addEventListener('click',()=>{
        const evt = new KeyboardEvent('keydown',{key});
        window.dispatchEvent(evt);
      });
    });

    // Controls wiring
    const speed = document.getElementById('speed');
    const wrap = document.getElementById('wrap');
    const grid = document.getElementById('grid');
    const contrast = document.getElementById('contrast');
    const motion = document.getElementById('motion');

    function syncControls(){
      speed.value = String(state.speed);
      wrap.checked = state.wrap;
      grid.checked = state.showGrid;
      contrast.checked = state.contrast;
      motion.checked = state.reducedMotion;
      document.querySelector('.app').setAttribute('data-contrast', state.contrast?'high':'normal');
    }

    speed.addEventListener('input',()=>{ state.speed = +speed.value; saveSettings(); });
    wrap.addEventListener('change',()=>{ state.wrap = wrap.checked; saveSettings(); });
    grid.addEventListener('change',()=>{ state.showGrid = grid.checked; saveSettings(); });
    contrast.addEventListener('change',()=>{
      state.contrast = contrast.checked; saveSettings();
      document.querySelector('.app').setAttribute('data-contrast', state.contrast?'high':'normal');
    });
    motion.addEventListener('change',()=>{ state.reducedMotion = motion.checked; saveSettings(); });

    document.getElementById('pause').addEventListener('click', togglePause);
    document.getElementById('btnReset').addEventListener('click',()=>{
      localStorage.removeItem('neon.high'); state.high=0; document.getElementById('high').textContent='0';
    });
    document.getElementById('btnNewSeed').addEventListener('click',()=>{
      const seed = Date.now(); localStorage.setItem('neon.seed', String(seed)); state.rng=new RNG(seed); placeFood();
    });
    document.getElementById('restart').addEventListener('click', reset);

    function togglePause(){ state.running = !state.running; announce(state.running? 'Resumed':'Paused'); }

    // Game loop with fixed timestep
    let acc = 0; let last = performance.now();
    function loop(now){
      const dt = (now - last)/1000; last = now; acc += dt;
      const step = 1/Math.max(1, state.speed);
      if(state.running && !state.over){
        while(acc >= step){ update(); acc -= step; }
      }
      render();
      requestAnimationFrame(loop);
    }

    function update(){
      state.dir = state.nextDir;
      const m = metrics();
      const head = {...state.snake[0]};
      head.x += state.dir.x; head.y += state.dir.y;

      if(state.wrap){
        head.x = (head.x + m.cols) % m.cols; head.y = (head.y + m.rows) % m.rows;
      } else {
        if(head.x<0 || head.y<0 || head.x>=m.cols || head.y>=m.rows){ return gameOver(); }
      }

      if(state.snake.some((s,i)=> i && s.x===head.x && s.y===head.y)) return gameOver();

      state.snake.unshift(head);
      if(head.x===state.food.x && head.y===state.food.y){
        state.score++; document.getElementById('score').textContent = state.score; announce('Score '+state.score);
        if(state.score>state.high){ state.high=state.score; localStorage.setItem('neon.high', String(state.high)); document.getElementById('high').textContent = state.high; }
        placeFood();
      } else {
        state.snake.pop();
      }
    }

    function gameOver(){
      state.over=true; state.running=false; announce('Game over');
      document.getElementById('finalScore').textContent = state.score;
      document.getElementById('finalHigh').textContent = state.high;
      document.getElementById('overlay').classList.add('show');
    }

    function render(){
      const w = canvas.width, h = canvas.height; ctx.clearRect(0,0,w,h);
      const m = metrics();

      if(state.showGrid){
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid');
        ctx.lineWidth = 1 * dpr;
        ctx.beginPath();
        for(let i=0;i<=m.cols;i++){
          const x = i * (w/m.cols); const y = i * (h/m.rows);
          ctx.moveTo(x,0); ctx.lineTo(x,h);
          ctx.moveTo(0,y); ctx.lineTo(w,y);
        }
        ctx.stroke();
      }

      const ac = getComputedStyle(document.documentElement).getPropertyValue('--ac').trim();
      const ac2 = getComputedStyle(document.documentElement).getPropertyValue('--ac2').trim();

      function rectCell(x,y,pad=2,color=ac){
        const px = x*(w/m.cols) + pad*dpr; const py = y*(h/m.rows) + pad*dpr;
        ctx.fillStyle = color;
        ctx.fillRect(px, py, (w/m.cols) - pad*2*dpr, (h/m.rows) - pad*2*dpr);
      }

      // Food glow
      rectCell(state.food.x, state.food.y, 4, ac2);

      // Snake
      for(let i=0;i<state.snake.length;i++){
        const seg = state.snake[i];
        rectCell(seg.x, seg.y, i===0?1:3, i===0?ac:ac2);
        if(!state.reducedMotion && i===0){
          ctx.globalAlpha=.25; rectCell(seg.x, seg.y, 0, ac); ctx.globalAlpha=1;
        }
      }
    }

    // Boot
    loadSettings();
    scaleCanvas();
    window.addEventListener('resize', scaleCanvas);
    document.getElementById('high').textContent = state.high;
    syncControls();
    placeFood();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
